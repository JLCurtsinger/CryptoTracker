<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Crypto Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Crypto Tracker</h1>

  <!-- Signals Section -->
  <div id="signals"></div>
  
    <!-- About Section -->
  <section id="about">
<!--     <h2>About This Website</h2> -->
    <p>
      This website provides real-time cryptocurrency analysis for assets available on Coinbase.com. It fetches live crypto data from CoinMarketCap.com. For each cryptocurrency, key metrics are calculated, including the Relative Strength Index (RSI) to identify overbought or oversold conditions, and Buy/Sell Certainty Scores, which are based on price changes, trading volume, and RSI values. The results are dynamically displayed on the table, showing price, RSI, volume, and the buy/sell confidence levels.
    </p>
    <p>
      Automated backend processing ensures the data stays up to date, with GitHub Actions running the analysis script and updating the information seamlessly. This makes the website an easy-to-use tool for traders and investors looking to potentially make slightly better decisions in the fast-moving crypto market.
    </p>
  </section>
  
  <!-- Best Bet Section -->
  <section id="best-bet"></section>

  <div id="profit"></div>

  <div id="holding-time"></div>
  
    <!-- Signals Table -->
  <div id="signals"></div>

  <!-- Top 10 Cryptos Table -->
  <section id="top-10"></section>

  <div id="timestamp"></div>

  <!-- Script Section -->
  <script>
    async function loadSignals() {
      const response = await fetch('./output.json');
      if (!response.ok) {
        document.getElementById('signals').innerText = "Failed to load signals.";
        return;
      }
      const data = await response.json();
      const suggestedHoldTime = `${data.suggested_holding_time} days`; // Retrieve from JSON
      document.getElementById('holding-time').innerText = `Suggested Holding Time: ${suggestedHoldTime}`;
      const buySignals = data.buy_signals || [];

      if (buySignals.length === 0) {
        document.getElementById('signals').innerText = "No buy signals found.";
        return;
      }

      if (data.best_bet) {
        const bestBet = data.best_bet;
        const projectedProfit = data.projected_profit_per_100 || 0; // Fallback to 0 if undefined
        const suggestedHoldTime = data.suggested_holding_time || "N/A";
      
        // Populate best-bet section
        document.getElementById('best-bet').innerHTML = `
          <h2>Best Bet</h2>
          <p>The cryptocurrency with the highest chance of profitability is <strong>${bestBet.name} (${bestBet.symbol})</strong>.</p>
          <p>Suggested Minimum Buy-in: $100</p>
          <p>Suggested Holding Time: ${suggestedHoldTime} days</p>
        `;
      
        // Populate profit section
        document.getElementById('profit').innerHTML = `
          <h2>Projected Profit</h2>
          <p>If you invest $100 in <strong>${bestBet.symbol}</strong> and hold it for ${suggestedHoldTime} days, your projected profit is approximately <strong>$${projectedProfit.toFixed(2)}</strong>.</p>
        `;
      }
          
      const timestamp = new Date(data.timestamp); // Assume timestamp from API is UTC
      const localTimestamp = timestamp.toLocaleString('en-US', { timeZoneName: 'short' });
      
      const timestampText = `Data last updated: ${localTimestamp}`;
      document.getElementById('timestamp').innerText = timestampText;

      let html = "<table border='1'><thead><tr><th>Coin</th><th>Price</th><th>RSI</th><th>Volume</th><th>Buy (%)</th><th>Sell (%)</th></tr></thead><tbody>";
      for (let signal of buySignals) {
        const graphUrl = `https://s3.coinmarketcap.com/generated/sparklines/web/1d/usd/${signal.symbol.toLowerCase()}.png`;
        html += `<tr>
          <td>${signal.symbol}</td>
          <td>$${signal.price.toFixed(2)}</td>
          <td>${signal.rsi.toFixed(2)}</td>
          <td>${signal.volume.toFixed(2)}<br><img src="${graphUrl}" alt="${signal.symbol} 1-day chart" style="width: 100px; height: 30px;"></td>
          <td>${signal.buy.toFixed(2)}</td>
          <td>${signal.sell.toFixed(2)}</td>
        </tr>`;
      }
      html += "</tbody></table>";
      document.getElementById('signals').innerHTML = html;
    }

    loadSignals();
    async function loadTop10() {
      const response = await fetch('./output.json');
      if (!response.ok) {
        document.getElementById('top-10').innerText = "Failed to load top 10 cryptos.";
        return;
      }
    
      const data = await response.json();
      const top10 = data.top_10_cryptos || [];
      const timestamp = data.timestamp;
    
      if (top10.length === 0) {
        document.getElementById('top-10').innerText = "No data available.";
        return;
      }
    
      let html = `<h2>Top 10 Cryptos by Market Cap</h2>
                  <p>Data collected at: ${timestamp}</p>
                  <table>
                    <thead>
                      <tr>
                        <th>Rank</th>
                        <th>Coin</th>
                        <th>Symbol</th>
                        <th>Market Cap</th>
                        <th>Price</th>
                        <th>Volume (24h)</th>
                      </tr>
                    </thead>
                    <tbody>`;
    
      for (let coin of top10) {
        html += `<tr>
                  <td>${coin.rank}</td>
                  <td>${coin.name}</td>
                  <td>${coin.symbol}</td>
                  <td>$${coin.market_cap.toLocaleString()}</td>
                  <td>$${coin.price.toFixed(2)}</td>
                  <td>$${coin.volume.toLocaleString()}</td>
                </tr>`;
      }
    
      html += "</tbody></table>";
      document.getElementById('top-10').innerHTML = html;
    }
    
    loadTop10();
    async function loadBestBet() {
      const response = await fetch('./output.json');
      if (!response.ok) {
        document.getElementById('best-bet').innerText = "Failed to load best bet.";
        return;
      }
    
      const data = await response.json();
      const bestBet = data.best_bet;
    
      if (!bestBet) {
        document.getElementById('best-bet').innerText = "No profitable coin found.";
        return;
      }
    
      const suggestedBuyIn = 100; // Suggested buy-in amount in USD
      const suggestedHoldTime = "1-2 weeks"; // Example holding time
    
      const html = `<h2>Your Best Bet</h2>
                    <p>The coin with the highest chance of profitability is:</p>
                    <p><strong>${bestBet.name} (${bestBet.symbol})</strong></p>
                    <p>Price: $${bestBet.price.toFixed(2)}</p>
                    <p>Suggested Buy-In: $${suggestedBuyIn}</p>
                    <p>Suggested Holding Time: ${suggestedHoldTime}</p>`;
      
      const profitText = `Projected profit per $100: $${data.projected_profit_per_100.toFixed(2)}`;
      document.getElementById('profit').innerText = profitText;
    
      document.getElementById('best-bet').innerHTML = html;
    }
    
    loadBestBet();
  </script>
</body>
</html>
